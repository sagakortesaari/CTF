# Stonks

I decided to try something noone else has before. I made a bot to automatically trade stonks for me using AI and machine learning. I wouldn't believe you if you told me it's unsecure!

vuln.c nc mercury.picoctf.net 6989

## Solution

The code for the vulnerable program can be found in `vuln.c`

We can see that the method `buy_stonks` puts the actual flag into a buffer. This is probably what we want to retrieve!

```
char api_buf[FLAG_BUFFER];
FILE *f = fopen("api","r");
if (!f) {
    printf("Flag file not found. Contact an admin.\n");
    exit(1);
}
fgets(api_buf, FLAG_BUFFER, f);

...

char *user_buf = malloc(300 + 1);
printf("What is your API token?\n");
scanf("%300s", user_buf);
printf("Buying stonks with token:\n");
printf(user_buf);
```

The vulnerability lies in the code above. In order to retrieve the contents of `api_buf`, we need to utilize the fact that the user can supply arbitrary input that is printed out later in the program. This can be exploited to retrieve data from the stack - a so-called format string attack.

See my solution in `exploit.py` that basically puts a bunch of `%x` into the `printf` call that will retrieve the flag from the stack. I wasn't sure how many bytes we needed to retrieve for the flag, so I just played around with the amount of `%x` until I got the correct flag. 